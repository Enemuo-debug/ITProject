<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creator Page</title>
  <link rel="stylesheet" href="creator.css" />
  <link rel="icon" href="./Zurus06.NAT.png" type="image/png">
</head>
<body>
  <header>
    <h1 id="UserName">UserName</h1>
    <nav>
        <a href="index.html">Home</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="posts.html">Back to Posts</a>
    </nav>
  </header>
  <div class="container">
    <div class="bioData">
        <img id="creatorAvatar" src="" alt="Creator Avatar" />
        <div class="userData">
            <h2 id="niche">Niche</h2>
            <p id="bio">Bio</p>
        </div>
    </div>

    <div class="postsSection">
        <h1>Posts by User</h1>
        <div class="postsContainer" id="postsContainer">
        </div>
        <h1>Quotes</h1>
        <div class="postsContainer" id="quotesContainer">
        </div>
    </div>
    </div>


  <footer>
    <p>&copy; 2025 Zurus06.NAT. All rights reserved.</p>
    <p id="joinDate">Joined @ </p>
  </footer>
  <script type="module">
    import { URL } from "./config.js";
    async function loadUser() {
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");
        
        const diceBearStyles = {
            Network_Design: "notionists",
            Network_Security: "fun-emoji",
            Network_Management_And_Monitoring: "adventurer",
            Network_Technology_And_Trends: "bottts",
            Networking_Troubleshooting_And_Optimization: "avataaars"
        };

        if (!id) {
            console.error("No user ID found in URL");
            window.location.href = "index.html";    
        }

        try {
        const response = await fetch(`${URL}/account/${id}`);
        const user = await response.json();

        document.getElementById("UserName").innerText = user.data.displayName;
        document.getElementById("niche").innerText = user.data.niche;
        document.getElementById("bio").innerText = user.data.bio;
        const nicheKey = user.data.niche.split(" ").join("_");
        const style = diceBearStyles[nicheKey];
        let creatorImgLink = `https://api.dicebear.com/7.x/${style}/svg?seed=${user.data.displayName}&backgroundColor=transparent`;
        document.getElementById("creatorAvatar").src = creatorImgLink;
        document.getElementById("joinDate").innerText += `${user.data.joinedAt.split(" ").join("-")}`;

        } catch (err) {
        console.error("Failed to load user", err);
        }
        try {
            const postsContainer = document.getElementById("postsContainer");
            postsContainer.innerHTML = "<p>Loading posts...</p>";

            const postsResponse = await fetch(`${URL}/posts/user/${id}`, {
                method: "GET",
                headers: { "Content-Type": "application/json" },
                credentials: "include"
            });

            if (!postsResponse.ok) {
                throw new Error(`HTTP error! status: ${postsResponse.status}`);
            }

            const postsData = await postsResponse.json();

            if (!postsData || postsData.length === 0) {
                postsContainer.innerHTML = "<h2>No posts available.</h2>";
                return;
            }

            let postsHTML = "";
            postsData.forEach(post => {
                postsHTML += `
                    <div class="postCard">
                        <h3>${post.caption}</h3>
                        <p>${post.intro}</p>
                        <a href="post.html?id=${post.id}">Read More</a>
                    </div>
                `;
            });
            postsContainer.innerHTML = postsHTML;
        } catch (error) {
            console.error("Failed to load posts:", error);
            document.getElementById("postsContainer").innerHTML = "<h2>Error loading posts.</h2>";
        }

        const quotesContainer = document.getElementById("quotesContainer");
        quotesContainer.innerHTML = "<p>Loading quotes...</p>";

        try {
            const quotesResponse = await fetch(`${URL}/quotes/user/${id}`, {
                method: "GET",
                headers: { "Content-Type": "application/json" },
                credentials: "include"
            });

            if (!quotesResponse.ok) {
                throw new Error(`HTTP error! status: ${quotesResponse.status}`);
            }

            const quotesData = await quotesResponse.json();

            const quotesArray = quotesData.data || [];

            if (quotesArray.length === 0) {
                quotesContainer.innerHTML = "<h2>No quotes available.</h2>";
                return;
            }

            let quotesHTML = "";
            quotesArray.forEach(q => {
                console.log(q);
                quotesHTML += `
                    <div class="postCard">
                        <h3>${q.message.slice(0, 100) + "..." || "No title"}</h3>
                        <p>${q.nameOfUser || ""}</p>
                        <a href="quote.html?id=${q.id}">Read More</a>
                    </div>
                `;
            });

            quotesContainer.innerHTML = quotesHTML;

        } catch (error) {
            console.error("Failed to load quotes:", error);
            quotesContainer.innerHTML = "<h2>Error loading quotes.</h2>";
        }

    }

    loadUser();
    </script>
</body>
</html>